$base = 'D:\Online Food Ordering Platform\Online-Food-Ordering-Platform'

# create folders
New-Item -ItemType Directory -Force -Path "$base\backend" | Out-Null
New-Item -ItemType Directory -Force -Path "$base\frontend\public" | Out-Null
New-Item -ItemType Directory -Force -Path "$base\frontend\src" | Out-Null

# backend/package.json
$backendPackage = @'
{
    "name": "food-backend",
    "version": "1.0.0",
    "main": "server.js",
    "scripts": {
        "start": "node server.js"
    },
    "dependencies": {
        "bcrypt": "^5.1.0",
        "cors": "^2.8.5",
        "express": "^4.18.2",
        "jsonwebtoken": "^9.0.0",
        "sqlite3": "^5.1.6",
        "body-parser": "^1.20.2"
    }
}
'@
$backendPackage | Out-File -FilePath "$base\backend\package.json" -Encoding utf8

# backend/db.js
$backendDb = @'
const sqlite3 = require('sqlite3').verbose();
const path = require('path');
const dbPath = path.join(__dirname, 'db.sqlite');
const db = new sqlite3.Database(dbPath);

function run(sql, params = []) {
    return new Promise((resolve, reject) => {
        db.run(sql, params, function (err) {
            if (err) reject(err);
            else resolve(this);
        });
    });
}

function all(sql, params = []) {
    return new Promise((resolve, reject) => {
        db.all(sql, params, (err, rows) => {
            if (err) reject(err);
            else resolve(rows);
        });
    });
}

function get(sql, params = []) {
    return new Promise((resolve, reject) => {
        db.get(sql, params, (err, row) => {
            if (err) reject(err);
            else resolve(row);
        });
    });
}

module.exports = { db, run, all, get };
'@
$backendDb | Out-File -FilePath "$base\backend\db.js" -Encoding utf8

# backend/server.js
$backendServer = @'
const express = require('express');
const cors = require('cors');
const bodyParser = require('body-parser');
const { run, all, get } = require('./db');
const bcrypt = require('bcrypt');
const jwt = require('jsonwebtoken');
const SECRET = 'DEMO_SECRET_KEY'; // replace in production

const app = express();
app.use(cors());
app.use(bodyParser.json());

// initialize schema + seed
async function init() {
    await run(`CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT,
        email TEXT UNIQUE,
        password TEXT
    )`);
    await run(`CREATE TABLE IF NOT EXISTS restaurants (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT,
        description TEXT
    )`);
    await run(`CREATE TABLE IF NOT EXISTS menu_items (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        restaurant_id INTEGER,
        name TEXT,
        price REAL,
        description TEXT,
        FOREIGN KEY(restaurant_id) REFERENCES restaurants(id)
    )`);
    await run(`CREATE TABLE IF NOT EXISTS orders (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        user_id INTEGER,
        items TEXT,
        total REAL,
        status TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY(user_id) REFERENCES users(id)
    )`);
    // seed
    const restaurants = await all('SELECT * FROM restaurants');
    if (restaurants.length === 0) {
        await run('INSERT INTO restaurants (name, description) VALUES (?,?)', ['Tasty Pizza', 'Wood-fired pizzas']);
        await run('INSERT INTO restaurants (name, description) VALUES (?,?)', ['Green Salad', 'Fresh healthy bowls']);
        await run('INSERT INTO menu_items (restaurant_id, name, price, description) VALUES (?,?,?,?)', [1, 'Margherita', 9.99, 'Tomato, mozzarella']);
        await run('INSERT INTO menu_items (restaurant_id, name, price, description) VALUES (?,?,?,?)', [1, 'Pepperoni', 11.5, 'Pepperoni and cheese']);
        await run('INSERT INTO menu_items (restaurant_id, name, price, description) VALUES (?,?,?,?)', [2, 'Caesar Bowl', 8.0, 'Romaine, chicken, dressing']);
    }
}
init().catch(console.error);

// auth
app.post('/api/register', async (req, res) => {
    const { name, email, password } = req.body;
    if (!email || !password) return res.status(400).json({ error: 'email and password required' });
    const hashed = await bcrypt.hash(password, 10);
    try {
        const r = await run('INSERT INTO users (name,email,password) VALUES (?,?,?)', [name || null, email, hashed]);
        const user = await get('SELECT id, name, email FROM users WHERE id = ?', [r.lastID]);
        const token = jwt.sign({ id: user.id }, SECRET, { expiresIn: '7d' });
        res.json({ user, token });
    } catch (err) {
        res.status(400).json({ error: 'email already exists' });
    }
});

app.post('/api/login', async (req, res) => {
    const { email, password } = req.body;
    const user = await get('SELECT * FROM users WHERE email = ?', [email]);
    if (!user) return res.status(401).json({ error: 'invalid credentials' });
    const ok = await bcrypt.compare(password, user.password);
    if (!ok) return res.status(401).json({ error: 'invalid credentials' });
    const token = jwt.sign({ id: user.id }, SECRET, { expiresIn: '7d' });
    res.json({ user: { id: user.id, name: user.name, email: user.email }, token });
});

// middleware
function auth(req, res, next) {
    const authHeader = req.headers.authorization;
    if (!authHeader) return res.status(401).json({ error: 'Not authenticated' });
    const token = authHeader.split(' ')[1];
    try {
        const data = jwt.verify(token, SECRET);
        req.userId = data.id;
        next();
    } catch (err) {
        res.status(401).json({ error: 'Invalid token' });
    }
}

// public endpoints
app.get('/api/restaurants', async (req, res) => {
    const rows = await all('SELECT * FROM restaurants');
    res.json(rows);
});
app.get('/api/restaurants/:id/menu', async (req, res) => {
    const items = await all('SELECT * FROM menu_items WHERE restaurant_id = ?', [req.params.id]);
    res.json(items);
});

// orders
app.post('/api/orders', auth, async (req, res) => {
    const { items, total } = req.body; // items = [{id, quantity, name, price}]
    if (!items || !total) return res.status(400).json({ error: 'items and total required' });
    const itemsJson = JSON.stringify(items);
    const r = await run('INSERT INTO orders (user_id, items, total, status) VALUES (?,?,?,?)', [req.userId, itemsJson, total, 'received']);
    const order = await get('SELECT * FROM orders WHERE id = ?', [r.lastID]);
    res.json(order);
});

app.get('/api/orders', auth, async (req, res) => {
    const rows = await all('SELECT * FROM orders WHERE user_id = ? ORDER BY created_at DESC', [req.userId]);
    res.json(rows.map(r => ({ ...r, items: JSON.parse(r.items) })));
});

const PORT = process.env.PORT || 4000;
app.listen(PORT, () => console.log(`Backend running on http://localhost:${PORT}`));
'@
$backendServer | Out-File -FilePath "$base\backend\server.js" -Encoding utf8

# frontend/package.json
$frontendPackage = @'
{
  "name": "food-frontend",
  "version": "1.0.0",
  "private": true,
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-scripts": "5.0.1"
  },
  "scripts": {
    "start": "react-scripts start"
  }
}
'@
$frontendPackage | Out-File -FilePath "$base\frontend\package.json" -Encoding utf8

# frontend/public/index.html
$indexHtml = @'
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Food Ordering Platform</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
  </head>
  <body>
    <div id="root"></div>
    <script src="../src/index.js"></script>
  </body>
</html>
'@
$indexHtml | Out-File -FilePath "$base\frontend\public\index.html" -Encoding utf8

# frontend/src/index.js
$srcIndex = @'
import React from 'react';
import { createRoot } from 'react-dom/client';
import App from './App';
const root = createRoot(document.getElementById('root'));
root.render(<App />);
'@
$srcIndex | Out-File -FilePath "$base\frontend\src\index.js" -Encoding utf8

# frontend/src/api.js
$srcApi = @'
const API = 'http://localhost:4000/api';

export async function register(payload){ return fetch(API + '/register', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)}).then(r=>r.json()) }
export async function login(payload){ return fetch(API + '/login', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)}).then(r=>r.json()) }
export async function getRestaurants(){ return fetch(API + '/restaurants').then(r=>r.json()) }
export async function getMenu(restaurantId){ return fetch(`${API}/restaurants/${restaurantId}/menu`).then(r=>r.json()) }
export async function placeOrder(token, payload){ return fetch(API + '/orders', { method:'POST', headers:{'Content-Type':'application/json', 'Authorization':`Bearer ${token}`}, body: JSON.stringify(payload)}).then(r=>r.json()) }
export async function getOrders(token){ return fetch(API + '/orders', { headers:{ 'Authorization': `Bearer ${token}` } }).then(r=>r.json()) }
'@
$srcApi | Out-File -FilePath "$base\frontend\src\api.js" -Encoding utf8

# frontend/src/App.js
$srcApp = @'
import React, { useEffect, useState } from 'react';
import { getRestaurants, getMenu, login, register, placeOrder, getOrders } from './api';

function App(){
  const [restaurants, setRestaurants] = useState([]);
  const [menu, setMenu] = useState([]);
  const [selectedRest, setSelectedRest] = useState(null);
  const [cart, setCart] = useState([]);
  const [user, setUser] = useState(null);
  const [token, setToken] = useState(localStorage.getItem('token')||'');
  const [orders, setOrders] = useState([]);

  useEffect(()=>{ getRestaurants().then(setRestaurants) },[]);
  useEffect(()=>{ if(token){ getOrders(token).then(setOrders) } },[token]);

  async function openMenu(rest){
    setSelectedRest(rest);
    const m = await getMenu(rest.id);
    setMenu(m);
  }
  function addToCart(item){ 
    setCart(c => {
      const copy = [...c];
      const idx = copy.findIndex(x=>x.id===item.id);
      if(idx>=0) copy[idx].qty++;
      else copy.push({...item, qty:1});
      return copy;
    });
  }
  function removeFromCart(id){ setCart(c => c.filter(x=>x.id!==id)) }
  function total(){ return cart.reduce((s,i)=>s + i.price * i.qty,0).toFixed(2) }

  async function doLogin(e){
    e.preventDefault();
    const form = new FormData(e.target);
    const payload = { email: form.get('email'), password: form.get('password') };
    const res = await login(payload);
    if(res.token){ setToken(res.token); localStorage.setItem('token', res.token); setUser(res.user) }
    else alert(res.error || 'Login failed');
  }
  async function doRegister(e){
    e.preventDefault();
    const form = new FormData(e.target);
    const payload = { name: form.get('name'), email: form.get('email'), password: form.get('password') };
    const res = await register(payload);
    if(res.token){ setToken(res.token); localStorage.setItem('token', res.token); setUser(res.user) }
    else alert(res.error || 'Register failed');
  }

  async function checkout(){
    if(!token) return alert('Please login to order');
    if(cart.length===0) return alert('Cart empty');
    const payload = { items: cart.map(i=>({id:i.id,name:i.name,price:i.price,quantity:i.qty})), total: parseFloat(total()) };
    const res = await placeOrder(token, payload);
    if(res.id){ setCart([]); setOrders(prev=>[res,...prev]); alert('Order placed') } else alert(res.error || 'Order failed');
  }

  return (
    <div style={{padding:20, fontFamily:'Arial'}}>
      <h1>Food Ordering Platform (demo)</h1>
      <div style={{display:'flex', gap:20}}>
        <div style={{flex:1}}>
          <h2>Restaurants</h2>
          <ul>
            {restaurants.map(r => (
              <li key={r.id}>
                <b>{r.name}</b> — {r.description}
                <button onClick={()=>openMenu(r)} style={{marginLeft:8}}>Open</button>
              </li>
            ))}
          </ul>
          <h2>Menu {selectedRest && `— ${selectedRest.name}`}</h2>
          <ul>
            {menu.map(m => (
              <li key={m.id}>
                {m.name} — ${m.price.toFixed(2)} <button onClick={()=>addToCart(m)}>Add</button>
                <div style={{fontSize:12}}>{m.description}</div>
              </li>
            ))}
          </ul>
        </div>

        //TensorWorks react Components

        <div style={{width:320, borderLeft:'1px solid #ccc', paddingLeft:20}}>
          <h3>Cart</h3>
          <ul>
            {cart.map(i=>(
              <li key={i.id}>{i.name} × {i.qty} — ${(i.price*i.qty).toFixed(2)} <button onClick={()=>removeFromCart(i.id)}>Remove</button></li>
            ))}
          </ul>
          <div>Total: ${total()}</div>
          <button onClick={checkout}>Checkout</button>

          <hr/>
          <div>
            {!token ? (
              <>
                <h4>Login</h4>
                <form onSubmit={doLogin}>
                  <input name="email" placeholder="email" required/><br/>
                  <input name="password" placeholder="password" type="password" required/><br/>
                  <button type="submit">Login</button>
                </form>
                <h4>Register</h4>
                <form onSubmit={doRegister}>
                  <input name="name" placeholder="name" /><br/>
                  <input name="email" placeholder="email" required/><br/>
                  <input name="password" placeholder="password" type="password" required/><br/>
                  <button type="submit">Register</button>
                </form>
              </>
            ) : (
              <>
                <div>Logged in</div>
                <button onClick={()=>{ localStorage.removeItem('token'); setToken(''); setUser(null); }}>Logout</button>
              </>
            )}
          </div>

          <hr/>
          <div>
            <h4>Your Orders</h4>
            {orders.map(o=>(
              <div key={o.id} style={{border:'1px solid #eee', padding:8, marginBottom:8}}>
                <div>Order #{o.id} — ${o.total} — {o.status}</div>
                <div style={{fontSize:12}}>{new Date(o.created_at).toLocaleString()}</div>
                <ul>{o.items.map(it=><li key={it.id}>{it.name} × {it.quantity}</li>)}</ul>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}

export default App;
'@
$srcApp | Out-File -FilePath "$base\frontend\src\App.js" -Encoding utf8

# README
$readme = @'
Setup and run (Windows):

1) Backend
cd "D:\Online Food Ordering Platform\Online-Food-Ordering-Platform\backend"
npm install
node server.js
// Backend runs at http://localhost:4000

2) Frontend (in separate terminal)
cd "D:\Online Food Ordering Platform\Online-Food-Ordering-Platform\frontend"
npm install
npm start
// React dev server will open (http://localhost:3000).

Notes:
- Replace SECRET in backend/server.js for production.
- This is a demo starter: add validations, secure headers, and production build steps.
'@
$readme | Out-File -FilePath "$base\README.md" -Encoding utf8

Write-Host "Files created under $base`."
Write-Host "To run the script output: powershell -ExecutionPolicy Bypass -File `"$($MyInvocation.MyCommand.Path)`""
'``

2) Frontend (in separate terminal)
cd "D:\Online Food Ordering Platform\Online-Food-Ordering-Platform\frontend"
npm install
npm start
// React dev server will open (http://localhost:3000).

Notes:
- Replace SECRET in backend/server.js for production.
- This is a demo starter: add validations, secure headers, and production build steps.
'@
$readme | Out-File -FilePath "$base\README.md" -Encoding utf8

Write-Host "Files created under $base`."
Write-Host "To run the script output: powershell -ExecutionPolicy Bypass -File `"$($MyInvocation.MyCommand.Path)`""
'``
